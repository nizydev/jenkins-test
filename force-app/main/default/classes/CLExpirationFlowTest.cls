@isTest()
public class CLExpirationFlowTest{
    @isTest
    public static void unitTest(){
        Validation_Rule_Setting__c setting = Validation_Rule_Setting__c.getInstance(UserInfo.getOrganizationId());
        setting.Disable_All_Rules__c = true;
        insert setting;
        Account acc = new Account();
        acc.name = 'ApplePie Capital';
        acc.recordTypeId = Schema.SObjectType.Account.getRecordTypeInfosByName().get('LENDER').getRecordTypeId();
        insert acc;
        Contact con = new Contact();
        con.firstName = 'Test';
        con.lastName = 'Con';
        con.AccountId = acc.Id;
        insert con;
        Opportunity opp = new Opportunity();
        opp.name='test2323';
        opp.stagename='Commitment Letter Sent';
        opp.Financing_Type__c ='APC Core';
        opp.CloseDate = date.today();
        insert opp;
        List<Loan_comparisons__c> plObjList = new List<Loan_comparisons__c>();
        Id CommitmentRequestRecordTypeId = Schema.SObjectType.Loan_comparisons__c.getRecordTypeInfosByName().get('Commitment Letter Request').getRecordTypeId();
        Loan_comparisons__c plObj = new Loan_comparisons__c();
        plObj.name='test123';
        plObj.RELATED_LENDER__C = acc.id;
        plObj.Opportunity__c = opp.id;
        plObj.Loan_amount__c = 64;
        plObj.Total_hours_in_UW__c =0;
        plObj.Product__c = 'CORE';
        plObj.Fixed_or_variable__c ='Fixed';
        plObj.Status__c ='Issued';
        plObj.Injection_required__c=11;
        plObj.Lenders__c='Applepie Capital';
        plObj.isLightningComponent__c = false;
        plObj.Eligible_Core_Loan_Purchaser__c='FIR';
        plObj.Priority__c='Low';
        plObj.Proposal_Request_Details__c='Low';
        plObj.Cross_Corporate_Guaranty__c ='Yes';
        plObj.Personal_Collateral__c ='None';
        plObj.Personal_Guaranty__c ='1';
        plObj.RecordtypeId = CommitmentRequestRecordTypeId;
        plObj.CL_Issuance_Date__c = date.today().addDays(-120);
        plObj.Prepayment_penalty__c=5.2;
        plObj.Rate__c=1;
        plObj.Term_in_months__c='60';
        plObj.Closing_Fee__c = 2;
        //insert plObj;
        plObjList.add(plObj);
        //Id CommitmentRequestRecordTypeId = Schema.SObjectType.Loan_comparisons__c.getRecordTypeInfosByName().get('Commitment Letter Request').getRecordTypeId();
        Loan_comparisons__c plObj3 = new Loan_comparisons__c();
        plObj3.name='test123';
        plObj3.RELATED_LENDER__C = acc.id;
        plObj3.Opportunity__c = opp.id;
        plObj3.Loan_amount__c = 64;
        plObj3.Total_hours_in_UW__c =0;
        plObj3.Product__c = 'CORE';
        plObj3.Fixed_or_variable__c ='Fixed';
        plObj3.Status__c ='Issued';
        plObj3.Injection_required__c=11;
        plObj3.Lenders__c='Applepie Capital';
        plObj3.isLightningComponent__c = false;
        plObj3.Eligible_Core_Loan_Purchaser__c='FIR';
        plObj3.Priority__c='Low';
        plObj3.Proposal_Request_Details__c='Low';
        plObj3.Cross_Corporate_Guaranty__c ='Yes';
        plObj3.Personal_Collateral__c ='None';
        plObj.Personal_Guaranty__c ='1';
        plObj3.RecordtypeId = CommitmentRequestRecordTypeId;
        plObj3.CL_Issuance_Date__c = date.today().addDays(-60);
        plObj3.Prepayment_penalty__c=5.2;
        plObj3.Rate__c=1;
        plObj3.Term_in_months__c='60';
        plObj3.Closing_Fee__c = 2;
        //insert plObj3;
        plObjList.add(plObj3);

        Id ProposalRequestRecordTypeId = Schema.SObjectType.Loan_comparisons__c.getRecordTypeInfosByName().get('Proposal Request').getRecordTypeId();
        Loan_comparisons__c plObj2 = new Loan_comparisons__c();
        plObj2.name='test123';
        plObj2.RELATED_LENDER__C = acc.id;
        plObj2.Opportunity__c = opp.id;
        plObj2.Loan_amount__c = 64;
        plObj2.Total_hours_in_UW__c =0;
        plObj2.Product__c = 'CORE';
        plObj2.Fixed_or_variable__c ='Fixed';
        plObj2.Status__c ='Issued';
        plObj2.Injection_required__c=11;
        plObj2.Lenders__c='Applepie Capital';
        plObj2.isLightningComponent__c = false;
        plObj2.Eligible_Core_Loan_Purchaser__c='FIR';
        plObj2.Priority__c='Low';
        plObj2.Proposal_Request_Details__c='Low';
        plObj2.Cross_Corporate_Guaranty__c ='Yes';
        plObj2.Personal_Collateral__c ='None';
        plObj2.Personal_Guaranty__c ='1';
        plObj2.RecordtypeId = ProposalRequestRecordTypeId ;
        plObj2.CL_Issuance_Date__c = date.today().addDays(-120);
        plObj2.Prepayment_penalty__c=5.2;
        plObj2.Rate__c=1;
        plObj2.Term_in_months__c='60';
        //insert plObj2;
        plObjList.add(plObj2);
        Loan_comparisons__c  CL = TestUtility.creditSubmissionRecord(Schema.SObjectType.Loan_comparisons__c.getRecordTypeInfosByName().get('Commitment Letter Request').getRecordTypeId(),true,'Issued'); 
        CL.CL_Issuance_Date__c = date.today().addDays(-15);
        update CL;
        //plObjList.add(CL);
        insert plObjList;
        test.startTest();
            CLExpirationFlow history = new CLExpirationFlow();
            string sch = '0 47 21 * * ?';
            System.schedule('CLExpirationFlow', sch, history);
        test.stopTest();
    }
}